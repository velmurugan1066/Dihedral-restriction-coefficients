from sage.all import *
from collections import Counter


# ------------------------------------------------------------
# Basic utilities for cycle types
# ------------------------------------------------------------

def permutation_with_cycle_type(mu):
    n = sum(mu)
    cycles = []
    current = 1

    for size in mu:
        cycle = tuple(range(current, current + size))
        current += size
        cycles.append(cycle)

    return Permutation(cycles)


def order(mu):
    return lcm(mu)


def power(mu, i):
    """
    Cycle type of the i-th power of an element of cycle type mu
    """
    return sorted(
        sum([[m // gcd(m, i)] * gcd(m, i) for m in mu], []),
        reverse=True
    )


# ------------------------------------------------------------
# Restriction coefficients to cyclic subgroups
# ------------------------------------------------------------

def a(la, mu, i):
    """
    Restriction coefficient corresponding to the i-th character
    of the cyclic subgroup generated by a permutation of type mu
    """
    m = order(mu)
    F = CyclotomicField(m)
    z = F.gen()

    return sum(
        symmetrica.charvalue(la, power(mu, j)) * z^(i * j)
        for j in range(m)
    ) / m


# ------------------------------------------------------------
# Restriction of S_n irreducibles to D_n
# ------------------------------------------------------------

def restriction_S_n_D_n(la):
    """
    Computes the restriction multiplicities of the irreducible
    S_n-representation indexed by la to the dihedral group D_n
    """
    n = sum(la)
    S = []

    # --------------------------------------------------------
    # Case: n odd
    # --------------------------------------------------------
    if n % 2 == 1:

        # Trivial character
        S.append(sum(symmetrica.charvalue(la, g.cycle_type())
                for g in DihedralGroup(n)) / (2 * n))

        # One-dimensional character: r -> 1, s -> -1
        S.append(a(la, [n], 0) - S[0])

        # Remaining two-dimensional irreducibles
        S += [a(la, [n], i) for i in range(1, (n - 1) // 2 + 1)]

        return S

    # --------------------------------------------------------
    # Case: n even
    # --------------------------------------------------------
    if n % 2 == 0:

        # Trivial character
        S.append(
            sum(symmetrica.charvalue(la, g.cycle_type())
                for g in DihedralGroup(n)) / (2 * n)
        )

        # One-dimensional character: r -> 1, s -> -1
        S.append(a(la, [n], 0) - S[0])

        # One-dimensional character: r -> -1, s -> 1
        c = sum(
            euler_phi(int(n / d))
            * symmetrica.charvalue(la, [int(n / d)] * d)
            * (-1)^d
            for d in divisors(n)
        )

        d = (
            (n / 2) * symmetrica.charvalue(la, [2] * int(n / 2))
            - (n / 2) * symmetrica.charvalue(
                la, [2] * (int(n / 2) - 1) + [1, 1]
            )
        )

        S.append((c + d) / (2 * n))

        # One-dimensional character: r -> -1, s -> -1
        S.append(a(la, [n], n / 2) - S[2])

        # Remaining two-dimensional irreducibles
        S += [a(la, [n], i) for i in range(1, int(n / 2) )]

        return S


# ------------------------------------------------------------
# Example
# ------------------------------------------------------------

restriction_S_n_D_n([10, 5, 1])

[611, 639, 625, 625, 1253, 1249, 1253, 1250, 1253, 1249, 1253, 1250]
